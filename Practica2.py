import math
import numpy as np


# Funcion que separa el mensaje en bloques de 7 digitos
def genera_cod2(msj_entrada):
    palabra = []
    lista_cod2 = []
    count = 0

    # Bucle que recorre todos los caracteres del mensaje
    for i in range(len(msj_entrada)):

        # Agrupa los digitos de 7 en 7
        palabra.append(int(msj_entrada[i]))
        count += 1
        if count > 6:
            lista_cod2.append(palabra)
            count = 0
            palabra = []

    return lista_cod2


# Funcion que elimina los 3 ultimos numeros de cada grupo de 7 digitos
def elimina_sobrantes(lista_cod2):
    lista_cod1=[]

    for i in lista_cod2:
        for j in range(3):
            del i[len(i) - 1]
        lista_cod1.extend(i)

    return lista_cod1


# Funcion que agrupa los digitos de 6 en 6, los traduce de binario a decimal, obtiene la letra y devuelve el mensaje
def genera_msj(lista_bloques):
    # print(lista_bloques)
    lista_letras = ""
    str_aux = ""
    count = 0
    for i in range(len(lista_bloques)):
        str_aux += str(lista_bloques[i])
        count += 1
        if count == long_min:
            # print(str_aux)
            lista_letras += alfabeto[int(str_aux,2)]
            str_aux = ""
            count = 0

    return lista_letras


def calcula_matriz_sindrome(msj):
    # Calcula la matriz que contiene los síndromes de cada una de las palabras código
    m_control_hamming = np.array([[0, 0, 0, 1, 1, 1, 1], [0, 1, 1, 0, 0, 1, 1], [1, 0, 1, 0, 1, 0, 1]])
    cod2 = genera_cod2(msj)
    m_msj = np.transpose(np.array([cod for cod in cod2]))

    m_sindrome = m_control_hamming.dot(m_msj)

    for fila in m_sindrome:
        for i, num in enumerate(fila):
            if num % 2 == 0:
                fila[i] = 0
            else:
                fila[i] = 1

    return m_sindrome


def calcula_pos_sindrome(m_sindrome):
    # Calcula la posición equivalente a cada uno de los síndrome, en decimal
    m_sind_trasp = np.transpose(m_sindrome)

    lista_pos = []
    
    for fila in m_sind_trasp:
        res = 0
        for i, num in enumerate(fila):
            res += num * 2 ** (len(fila) - i - 1)

        lista_pos.append(res)

    return lista_pos


def corrige_errores(posiciones, cod2):
    # Aplica los cambios en las palabras códigos en base a las posiciones correspondientes

    for i, num in enumerate(posiciones):
        if cod2[i][num - 1] == 0:
            cod2[i][num - 1] = 1
        elif cod2[i][num - 1] == 1:
            cod2[i][num - 1] = 0

    return cod2


msj_entrada = "10010110100000010111111011001100000011011000111110000110100011000011001000110011101110100100010000000011110001000100110011010011011000100000000110000111101010011000011101000001110011111010101110010000110010110000100000101101111100100010011011101011010010100111100011101110100100011001011111100110110010010101001110001110011000101010011011011001110110101111100011000100000100011000001111101100100000000111101100011111011011011001111001000011100001101000101001110010001001100000111011000010010000110010110000100000000101101110110001001000110001010110101100010011100011010110011000000100010101011011110101010110001011011110011011010011000110000011010100100001100010011011010010010100001000001111110111000100110101110110011110001000100010010010100110110001110010110011010110100011001110101000000101110010110010111010101011010001001100001010001000001101100011000011111011001111001011101101101100001100000010110110010110101101000011011001100001111110001101101100011100011011010100000101101110100010011100011011010010101100000011101000000001011000101111110010001001101110111100011011001000000100010001110100100000110010110100101000000101110001110010110101010011010001001101110000011100111101001011011000010001001100001011101110100100010000001111100111100000011101000010001001000110111001110100100011110011010000010001100101001010100100011011101111110001000111000000101110110101100111010110110001101101001011011000010111000110000001111000110100100000111100011100111000101110010100110100010000100010001101101010011111100001000110110000111110011000111000000001111100100001101010000100011011000110000100011001110011011100100011000011001100000001110011010101100101100010101000110001000101110100011001111001100100101000000111010101000011011001111000100011010110010011110010110001000000110101111100111011001110110010100100010011101100110110010111000100000100010010110010001010011011000011001010000011010100100010110110010110010000001100101111010100111110110000010011001110010101111110101000010010010011001110000001111000101010011011011000101001110010110110010111010111011101110010100011011010000010010100011011010000111111000101010011010001001010000000011000110100100000010011000111100000011100000010111000110000001110010001000100000110111000111100010101010110000010100000011010100101011000110000011010000111110100000010011010110010000011111100100001110100110010011010100100011110011010000100000101101100111100111101010011001110000111101001011111011000111111010011100100110111001000110010011010101101010011111001110011110011110100011010001001110110011000000111101011100101001111110101010110001110011100111110101011010111111000111011010110010110010010011011010001000111110101110010110011110101111100100100100010000110001110010001001010000111011000010011010110010110010000000000101100010111011000101001010001101101100000011111100011010100100011100011000001111010011001010101011110010101010110000010011010011000010101110011010110001110000010010001000111100110011111100001110001101101100100011100011010001000100110011101110010100011110011010010000000110101111010100011001000110110111010110010100010110110000010011100000100011011100111010000111110010111000110000001110010111001111001101100100000111100101001000100000111010000100111100001100011111000011011011001100000110101010111001000000010110100010011000101011010000010000110000010011001101100110101100011010111000100000011101110101101011100001111011011001010000011101100100001110101110001110111010001010010011010001000000011101011001101100110000001101010011110100011"
alfabeto = ";l9Ci)dmSra6noshíy,(gtvfbcq.-é:zAOpNuL1 02ó3e"
long_min = int(math.log2(len(alfabeto))) + 1

ruido = "si" == input("¿Hay ruido?: ").lower()

if ruido:
    matriz_sindrome = calcula_matriz_sindrome(msj_entrada)

    palabras_codigo = corrige_errores(calcula_pos_sindrome(matriz_sindrome), genera_cod2(msj_entrada))

    msj_original = genera_msj(elimina_sobrantes(palabras_codigo))

    print(msj_original.replace("  ", "\n"))
else:
    print(genera_msj(elimina_sobrantes(genera_cod2(msj_entrada))))